# **ΑΡΧΙΤΕΚΤΟΝΙΚΗ ΥΠΟΛΟΓΙΣΤΩΝ**
### 1η Εργαστηριακή Άσκηση
&nbsp;
**Βερβέρης Χρήστος 8079**
**Λαμπράκη Έφη 9320**
&nbsp;

##### **Ερώτημα 1o:**  
Βασικά στοιχεία του συστήματος από το αρχείο _starter_se.py_ 

CPU type : 
* MinorCPU

Frequency : 
* 1 GHz

Caches :
* dcache (L1D)  
* icache(L1I)  
* itb_WalkCache  
* dtb_WalkCache  
* L2 Cache(shared)

Memory:  
* Type -> _"DDR3_1600_8x8"_  
* Size_of_mem -> 2GB

Basic units:  
* Minor CPU
* Memory Bus
* Memory Units (mem_ctrls0, mem_ctrls1)  

##### **Ερώτημα 2o:**  
Επαλήθευση αποτελεσμάτων πρώτου ερωτήματος χρησιμοποιώντας πληροφορίες από το αρχείο gem5/hello_result/config.ini  

CPU type : 
* system.cpu_cluster.cpus.type = MinorCPU  

Frequency : 
* (time_sync_period=)100000000000 / (clock=)1000  = 1 GHz

Caches:
* system.cpu_cluster.cpus.children = dcache, dtb, dtb_walker_cache, icache, isa, itb, itb_walker_cache
    
Memory:
* [system.mem_ctrls0]  
* [system.mem_ctrls1]  


##### **Ερώτημα 3ο:**
Ο gem5 χρησιμοποιεί δύο μοντέλα που κληρονομούν από το BaseSimpleCPU, δηλ. τα **AtomicSimpleCPU** και **TimingSimpleCPU**. Επίσης, χρησιμοποιεί το **MinorCPU** μοντέλο, και το High-Performance In-order **(HPI) CPU**.

* **AtomicSimpleCPU** : Xρησιμοποιείται το απλοποιημένο ατομικό μοντέλο πρόσβασης στη μνήμη  και οι caches αγνοούνται. Το μοντέλο αυτό του επεξεργαστή πραγματοποιει όλους τους χειρισμούς μιας εντολής σε έναν κύκλο της CPU και μπορεί να κάνει μια πρόχειρη εκτίμηση του συνολικού χρόνου πρόσβασης στην cache από τον υπολογισμό της καθυστέρησης από τις ατομικές προσβάσεις. Το AtomicSimpleCPU παρέχει τη γρηγορότερη λειτουργική προσομοίωση και μπορεί να χρησιμοποιηθεί για γρήγορη προσπέλαση (fast-forwarding) σε ένα ROI (Region of interest). 

* **TimingSimpleCPU** : Το TimingSimpleCPU υιοθετεί χρονική πρόσβαση στη μνήμη σε αντίθεση με το προηγούμενο μοντέλο. Αυτό σημαίνει ότι περιμένει μέχρι να επιστρέψει η επόμενη πρόσβαση στη μνήμη πριν προχωρήσει. Για τον λόγο αυτό παρέχει κάποια επίπεδα χρόνου εκτέλεσης. Και αυτό το μοντέλο είναι γρήγορο στην εκτέλεση καθώς απλοποιεί κάποιες διαδικασίες συμπεριλαμβανομένου του pipeline. Αυτό σημαίνει ότι μόνο μια έντολη εκτελείται κάθε χρονική στιγμή. Κάθε αριθμητική εντολή εκτελείται από αυτό το μοντέλο επεξεργαστή σε έναν κύκλο CPU, ενώ η πρόσβαση στη μνήμη απαιτεί πολλαπλούς κύκλους. Για παράδειγμα το μοντέλο αυτό καλεί την sendTiming() και ολοκληρώνει μια εντολή fetch αφού επιστρέψει επιτυχώς από την recvTiming().

* **MinorCPU** : Επιπρόσθετα με τίς μονάδες του Ατομικού μοντέλου, χρησιμοποιεί walk caches καθώς και L1 και L2 caches. Είναι ένας ευέλικτος in order επεξεργαστής που αναπτύχθηκε για να υποστηρίξει το Arm ISA και βρίσκει εφαρμογή και σε άλλα ISAs. Ο MinorCPU έχει μια καθορισμένη in order εκτέλεση pipeline τεσσάρων σταδίων, ενώ παράλληλα διαθέτει διαμορφωσιμες δομές δεδομένων καθώς και συμπεριφορά εκτέλεσης. Τα τέσσερα σταδια του pipeline που υλοποιούνται από τον MinorCPU περιλαμβάνουν fetching lines, αποσύνθεση σε macro-ops, αποσύνθεση των macro-ops σε micro-ops και εκτέλεση. Αυτά τα στάδια ονομάζονται Fetch1, Fetch2, Decode και Execute αντίστοιχα. Η pipeline κλάση ελέγχει το cyclic tick και την αναμονή.

* **HPI**: Αρκετά παρόμοιο με τον MinorCPU παρόλο που οι τιμές των παραμετρων είναι διαφορετικές. Το HPI CPU timing μοντέλο είναι συντονισμένο να αντιπροσωπεύει ένα μοντέρνο in order Armv8-A μοντέλο εκτέλεσης. Το pipeline του HPI χρησιμοποιεί το ίδιο μοντέλο τεσσάρων σταδίων με τον MinorCPU που περιγράφηκε.

**a)** Χρησιμοποιώντας τις εντολές 
./build/ARM/gem5.opt configs/example/se.py **--cpu-type=MinorCPU** --caches -c /Θέση του αρχείου στο σύστημα/
./build/ARM/gem5.opt configs/example/se.py **--cpu-type=TimingSimpleCPU** --caches -c /Θέση του αρχείου στο σύστημα/
διαπιστώσαμε ότι το πρώτο μοντέλο ολοκληρώνει την διαδικασία σε 31.183.000 ticks και το δεύτερο μοντέλο σε 36.547.000.
Επομένως, το MinorCPU είναι πιο γρήγορο από το TimingSimpleCPU.

**b)** Σύμφωνα με τα παραπάνω αυτό συμβαίνει επειδή το MinorCPU έχει τέσσερα στάδια pipeline ενώ το TimingSimpleCPU δεν υποστηριζει pipelines.

**c)** Αλλάζοντας στην παραπάνω εντολή, την συχνότητα για τα 2 μοντέλα (πχ για **TimingSimpleCPU** στα **2GHz**
./build/ARM/gem5.opt configs/example/se.py --cpu-type=TimingSimpleCPU **--sys-clock="2GHz"** --caches -c /Θέση του αρχείου στο σύστημα/) έχουμε τα εξής αποτελέσματα:

|                   | 0.5 GHz       | 1 GHz         | 2 GHz         |
| :---:             |    :----:     |   :----:      |:----:         |  
| MinorCPU          | 36.520.000    | 31.183.000    | 28.306.500    |
| TimingSimpleCPU   | 42.196.000    | 36.547.000    | 33.805.000    |

Αυτό που παρατηρούμε είναι ότι όσο αυξάνεται η συχνότητα τόσο πιο γρήγορα εκτελείται το πρόγραμμα. Είναι λογικό καθώς οι επεξεργαστές με μεγαλύτερες συχνότητες επεξεργάζονται τα δεδομένα ταχύτερα.

Αλλάζοντας στην παραπάνω εντολή, την τεχνολογία της μνήμης για τα 2 μοντέλα (πχ για **TimingSimpleCPU** στα **1GHz**
./build/ARM/gem5.opt configs/example/se.py --cpu-type=TimingSimpleCPU --sys-clock="1GHz" **--mem-type="DDR4_2400_4x16"** --caches -c /Θέση του αρχείου στο σύστημα/) έχουμε τα εξής αποτελέσματα:

|                   | DDR3_1600_8x8 | DDR4_2400_4x16| HBM_1000_4H_1x128 |
| :---:             |    :----:     |   :----:      |:----:             |  
| MinorCPU          | 31.183.000    | 31.578.000    |33.579.000         |
| TimingSimpleCPU   | 36.547.000    | 37.423.000    |38.731.000         |

Εδώ παρατηρούμε ότι η DDR3 αποδίδει καλύτερα από την DDR4 και την HBM στην εκτέλεση του απλού προγράμματος. Πριν κάνουμε την εκτέλεση περιμέναμε ότι η DDR4 θα απέδιδε καλύτερα από την DDR3 λόγω του ότι τρέχει με περισσότερα MHz, 2400 έναντι 1600, και λόγω του ότι είναι πιο καινούργια τεχνολογία. Μάλλον, στην εκτέλεση αυτού του απλού προγράμματος η DDR3 αποδίδει καλύτερα αλλά σε πιο απαιτητικές εκτελέσεις η DDR4 θα απέδιδε καλύτερα.

## ΒΙΒΛΙΟΓΡΑΦΙΑ
“Documentation - gem5.” http://gem5.org/Documentation.
“General memory system - gem5.” http://www.gem5.org/General_Memory_System.
“Inside the minor cpu model.” http://www.gem5.org/docs/html/minor.html.